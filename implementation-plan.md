# План реализации SO Start Grid

## Этап 1: Настройка проекта и инфраструктура

### 1.1 Инициализация React + TypeScript проекта
- Создать проект с использованием Vite или Create React App
- Настроить TypeScript конфигурацию
- Настроить структуру папок (components, utils, types, stores)
- Добавить базовые зависимости (React, ReactDOM, TypeScript)
- Настроить маршрутизацию (React Router или условный рендеринг):
  - Маршрут "/" или отсутствие currentProjectId → ProjectList
  - Маршрут "/project/:id" или наличие currentProjectId → StartGridView

### 1.2 Настройка PWA
- Добавить service worker для работы офлайн
- Настроить манифест (manifest.json) для установки на устройство
- Настроить иконки приложения
- Тестирование установки PWA на мобильное устройство

### 1.3 Настройка интернационализации (i18n)
- Установить и настроить react-i18next
- Создать файлы переводов (ru.json, en.json, kk.json) - русский, английский, казахский
- Реализовать переключение языков через контекстное меню
- Добавить переводы для всех текстов интерфейса
- Сохранять выбранный язык в LocalStorage

### 1.4 Настройка стилей
- Выбрать и настроить CSS-фреймворк (Tailwind CSS или styled-components)
- Создать базовые компоненты (кнопки, таблицы, модальные окна)
- Настроить адаптивный дизайн для мобильных устройств

## Этап 2: Система управления проектами

### 2.1 Главная страница (ProjectList)
- Компонент ProjectList для отображения списка проектов
- Адаптивное отображение на основе наличия проектов:
  - Если проектов нет (массив `projects` пуст) - показывать только кнопку "Создать проект"
  - Если проекты есть - показывать список проектов + кнопку "Создать проект"
- Автоматическое обновление при изменении списка проектов:
  - После удаления проекта компонент перерисовывается
  - Если удален последний проект - автоматически показывается только кнопка "Создать проект"
  - Если остались другие проекты - показывается список + кнопка
- Каждый проект в списке отображает:
  - Название проекта (название соревнования + дата)
  - Дата создания/последнего изменения
  - Возможно: количество участников
- Клик по проекту открывает его (переход к StartGridView)
- Навигация обратно к списку проектов через контекстное меню (опция "Вернуться к списку проектов")

### 2.2 Создание проекта
- Компонент FileUploader для загрузки HTML файла
- Парсинг импортированного файла
- Генерация имени проекта: `${race.title} - ${date}` (название соревнования + дата)
- Создание уникального ID проекта (UUID или timestamp)
- Сохранение проекта в LocalStorage
- Автоматический переход к созданному проекту

### 2.3 Хранение проектов
- Структура хранения в LocalStorage:
  - `projects: Project[]` - массив всех проектов
  - Каждый проект содержит: id, name, createdAt, raceData, statuses, timerState
- Реализация функций работы с проектами:
  - `getProjects()` - получить список всех проектов
  - `getProject(id)` - получить конкретный проект
  - `saveProject(project)` - сохранить проект
  - `createProject(raceData)` - создать новый проект
  - `deleteProject(id)` - удалить проект из массива проектов

## Этап 3: Парсинг и обработка данных

### 3.1 Парсинг HTML файла SportOrg
- Создать утилиту для загрузки HTML файла
- Извлечь JavaScript объект `race` из HTML
- Парсинг структуры данных (persons, groups, organizations)
- Валидация импортированных данных

### 3.2 Обработка данных участников
- Преобразование `start_time` из миллисекунд в читаемый формат
- Группировка участников по времени старта и коридорам
- Создание типов TypeScript для данных (Person, Group, Race, Project)
- Создание модели данных для хранения статусов участников

### 3.3 Хранение данных проекта
- Каждый проект хранит свои данные независимо
- Структура проекта в LocalStorage:
  - `id: string` - уникальный идентификатор
  - `name: string` - название проекта
  - `createdAt: number` - время создания
  - `updatedAt: number` - время последнего обновления
  - `raceData: Race` - данные соревнования
  - `statuses: Record<string, ParticipantStatus>` - статусы участников
  - `timerState: { started: boolean, startTime: number | null, currentRow: number | null }`
  - `settings: { autoScrollEnabled: boolean }` - настройки проекта (автоскроллинг включен по умолчанию: true)
- Автоматическое сохранение при каждом изменении
- Восстановление данных проекта при открытии

## Этап 4: Интерфейс отображения шахматки

### 4.1 Компонент таблицы шахматки
- Создать компонент StartGridTable
- Колонка "Время" - отображение времени старта
- Динамические колонки для каждого коридора
- Адаптивная верстка для мобильных устройств

### 4.2 Отображение участников
- Компонент ParticipantCell для отображения номера участника
- Цветовая индикация статусов (зеленый/оранжевый/красный)
- **Важно**: Дополнительная информация (ФИО, группа, статус оплаты) отображается только при долгом нажатии
- В таблице по умолчанию показываются только номера участников

### 4.3 Интерактивность
- Обработка быстрого нажатия (click) - статус "Зашел"
- Обработка долгого нажатия (long press) - показ меню с дополнительной информацией и опциями
- Компонент модального меню с опциями:
  - Показ информации о участнике (ФИО, группа, статус оплаты)
  - "Опоздал" (оранжевый цвет)
  - "Не пришел" (красный цвет)
  - "Сбросить" (возврат в неотмеченное состояние)
- Опция "Сбросить" возвращает участника в неотмеченное состояние (not_set)
- Визуальная обратная связь при взаимодействии

## Этап 5: Таймер и отслеживание времени

### 5.1 Реализация таймера
- Компонент кнопки "Старт" в верхней части шахматки
- После нажатия "Старт" кнопка скрывается (условный рендеринг)
- Хранение времени старта таймера в состоянии и LocalStorage
- Хранение текущей строки (индекс в массиве строк)
- Обновление текущего времени каждую секунду
- Выделение текущей строки

### 5.2 Вычисление интервалов между строками
- Функция для вычисления интервала между двумя строками
- Интервал = разница между временем старта следующей строки и текущей строки
- Создание массива интервалов для всех пар строк:
  - `intervals[i]` = интервал между строкой i и строкой i+1
  - Для последней строки интервал = null (или последний известный интервал)
- Примеры:
  - Строка 1: 10:01:00, Строка 2: 10:02:00 → интервал = 1 минута (60000 мс)
  - Строка 2: 10:02:00, Строка 3: 10:04:00 → интервал = 2 минуты (120000 мс)
  - Строка 3: 10:04:00, Строка 4: 10:05:00 → интервал = 1 минута (60000 мс)

### 5.3 Выделение текущей строки и переход на следующую
- Определение текущей строки на основе прошедшего времени:
  - Начало: currentRow = 0
  - Прошедшее время = Date.now() - timerStartTime
  - Суммировать интервалы до тех пор, пока сумма < прошедшего времени
  - Текущая строка = индекс последнего просуммированного интервала
- Подсветка строки таблицы для текущей строки
- Автоматический переход на следующую строку, когда прошедшее время >= сумме интервалов до следующей строки
- Визуальная индикация (например, цвет фона)

### 5.3.1 Автоматический скроллинг текущей строки
- Реализация автоматического скроллинга при переходе на новую строку
- Использование `scrollIntoView` или `scrollTo` для прокрутки к текущей строке
- Текущая строка должна быть сверху экрана (align: "start" или top: 0)
- Скроллинг происходит плавно (smooth scroll)
- Флаг `autoScrollEnabled` для управления включением/выключением
- Сохранение состояния `autoScrollEnabled` в LocalStorage (в настройках проекта)
- При ручном скроллинге пользователем - не переопределять его позицию (если пользователь сам скроллит, автоскроллинг не вмешивается)
- Логика: автоскроллинг работает только если пользователь не прокручивал таблицу вручную последние N секунд (например, 3 секунды)

### 5.4 Расчет опоздания
- Фиксация времени нажатия кнопки "Опоздал"
- Расчет разницы между временем старта и временем опоздания
- Округление до минут
- Сохранение времени опоздания в данных участника

### 5.5 Контекстное меню
- Иконка контекстного меню (три точки или три полоски) в нижней правой части экрана
- Компонент ContextMenu с опциями:
  - **"Завершить"** - останавливает таймер, показывает кнопку "Старт" снова
  - **"Отчет"** - открывает страницу/модальное окно с отчетом
  - **"Язык"** - открывает подменю выбора языка (русский, английский, казахский)
  - **"Авто скроллинг текущей строки"** - переключатель (toggle/checkbox) для включения/выключения автоматического скроллинга
    - Визуальная индикация состояния (галочка/чекбокс)
    - Сохранение состояния в настройках проекта
  - **"Сбросить таймер на N строку"** - открывает диалог подтверждения:
    - Поле ввода номера строки (input number)
    - Предупреждающий текст: "Все статусы участников после этой строки будут сброшены, вы уверены?"
    - Кнопки "Отмена" и "Сбросить"
    - При подтверждении:
      - Определить участников, стартующих после указанной строки
      - Сбросить их статусы в `not_set`
      - Пересчитать время старта таймера на указанную строку
      - Обновить `timerStartTime` и `currentMinute`
  - **"Удалить текущий проект"** - открывает диалог подтверждения:
    - Предупреждающий текст: "Вы уверены, что хотите удалить этот проект? Это действие нельзя отменить."
    - Кнопки "Отмена" и "Удалить"
    - При подтверждении:
      - Удалить проект из массива проектов в LocalStorage
      - Вернуться к списку проектов (ProjectList)
  - **"Вернуться к списку проектов"** - возврат к главной странице со списком проектов
- Модальное окно для подтверждения сброса таймера
- Модальное окно для подтверждения удаления проекта

## Этап 6: Отчеты и экспорт

### 6.1 Компонент отчета
- Создать страницу/компонент ReportView
- Раздел "Общая статистика": количество зашедших + опоздавших
- Раздел "Опоздавшие": таблица с номерами, ФИО, временем опоздания
- Раздел "Не пришедшие": таблица с номерами и ФИО

### 6.2 Экспорт данных
- Функция экспорта в JSON формат
- Функция экспорта в CSV формат
- Кнопки для скачивания файлов
- Форматирование данных для экспорта

### 6.3 Печать отчета
- Стили для печати (@media print)
- Оптимизация макета для печати
- Кнопка "Печать" с вызовом window.print()

## Этап 7: Дополнительные функции

### 7.1 Загрузка файла
- Компонент для загрузки HTML файла
- Drag & drop поддержка
- Валидация формата файла
- Обработка ошибок при загрузке

### 7.2 Настройки языка
- Переключение языка через контекстное меню
- Подменю "Язык" с опциями: Русский, English, Қазақша
- Визуальная индикация текущего языка
- Сохранение выбранного языка в LocalStorage
- Автоматическое применение языка при загрузке приложения

### 7.3 Обработка ошибок
- Обработка ошибок парсинга файла
- Валидация структуры данных
- Сообщения об ошибках для пользователя
- Fallback для отсутствующих данных

## Этап 8: Тестирование и оптимизация

### 8.1 Тестирование функциональности
- Тестирование парсинга различных форматов HTML
- Тестирование работы с несколькими коридорами
- Тестирование таймера и выделения строк
- Тестирование экспорта данных
- Тестирование функции сброса статуса
- Тестирование отображения дополнительной информации при долгом нажатии

### 8.2 Мобильное тестирование
- Тестирование на различных мобильных устройствах
- Проверка работы PWA (установка, офлайн режим)
- Тестирование жестов (долгое нажатие, свайпы)

### 8.3 Оптимизация производительности
- Оптимизация рендеринга больших таблиц
- Виртуализация списка, если участников очень много
- Оптимизация работы с LocalStorage
- Минимизация bundle size

## Технические детали

### Структура проекта

```
src/
  components/
    ProjectList/
      ProjectList.tsx
      ProjectList.module.css
      ProjectCard.tsx
    StartGridTable/
      StartGridTable.tsx
      StartGridTable.module.css
    ParticipantCell/
      ParticipantCell.tsx
      ParticipantCell.module.css
    Timer/
      Timer.tsx
      Timer.module.css
    ReportView/
      ReportView.tsx
      ReportView.module.css
    FileUploader/
      FileUploader.tsx
      FileUploader.module.css
    StatusMenu/
      StatusMenu.tsx
      StatusMenu.module.css
    ContextMenu/
      ContextMenu.tsx
      ContextMenu.module.css
    ResetTimerDialog/
      ResetTimerDialog.tsx
      ResetTimerDialog.module.css
    DeleteProjectDialog/
      DeleteProjectDialog.tsx
      DeleteProjectDialog.module.css
  utils/
    parser.ts          # Парсинг HTML файла
    storage.ts         # Работа с LocalStorage
    export.ts          # Экспорт данных
    time.ts            # Работа со временем, вычисление интервалов между строками
  types/
    race.ts            # Типы данных
    participant.ts     # Типы участников
  stores/
    projectStore.ts    # Состояние проектов и текущего проекта
    statusStore.ts     # Статусы участников (внутри проекта)
  i18n/
    ru.json
    en.json
    kk.json
    index.ts
  App.tsx
  main.tsx
```

### Ключевые компоненты

#### ProjectList
Главная страница списка проектов

- **Props**:
  - `projects: Project[]` - массив всех проектов
  - `onCreateProject: () => void` - обработчик создания нового проекта
  - `onSelectProject: (projectId: string) => void` - обработчик выбора проекта

- **Функционал**:
  - Адаптивное отображение на основе массива `projects`:
    - Если `projects.length === 0` - показывает только кнопку "Создать проект"
    - Если `projects.length > 0` - показывает список проектов + кнопку "Создать проект"
  - Автоматически реагирует на изменения массива проектов (через React state или реактивный store)
  - После удаления проекта компонент перерисовывается с обновленным списком
  - Каждый проект отображается в виде карточки (ProjectCard)
  - Клик по проекту открывает его (переход к StartGridView)
  - Клик по "Создать проект" открывает FileUploader

#### ProjectCard
Карточка проекта в списке

- **Props**:
  - `project: Project` - данные проекта
  - `onClick: () => void` - обработчик клика

- **Функционал**:
  - Отображает название проекта
  - Отображает дату создания/последнего изменения
  - Возможно: количество участников
  - Визуальное оформление карточки с hover эффектом

#### StartGridTable
Главная таблица шахматки

- **Props**: 
  - `raceData: Race` - данные соревнования
  - `statuses: Record<string, ParticipantStatus>` - статусы участников
  - `currentRow: number | null` - текущая строка (индекс) для подсветки
  - `autoScrollEnabled: boolean` - включен ли автоскроллинг
  - `onParticipantClick: (bib: number) => void` - обработчик быстрого клика
  - `onParticipantLongPress: (participant: Person, event: TouchEvent) => void` - обработчик долгого нажатия
  - `onScroll?: () => void` - обработчик ручного скроллинга (для отслеживания пользовательского взаимодействия)

- **Функционал**:
  - Отображает таблицу с временами и участниками
  - Динамически создает колонки для каждого коридора
  - Подсвечивает текущую строку по индексу (не по минутам)
  - Строки отсортированы по времени старта (как в исходных данных)
  - При изменении `currentRow` и если `autoScrollEnabled === true`:
    - Прокручивает таблицу так, чтобы текущая строка была сверху экрана
    - Использует `scrollIntoView({ behavior: 'smooth', block: 'start' })` или `scrollTo`
  - Отслеживает ручной скроллинг пользователя (onScroll) для предотвращения конфликта с автоскроллингом
  - Refs для строк таблицы для точного позиционирования

#### ParticipantCell
Ячейка с номером участника

- **Props**:
  - `participant: Person` - данные участника
  - `status: ParticipantStatus` - текущий статус
  - `onQuickClick: () => void` - обработчик быстрого клика
  - `onLongPress: (event: TouchEvent) => void` - обработчик долгого нажатия

- **Функционал**:
  - Отображает номер участника с цветом статуса
  - Обрабатывает быстрый клик (устанавливает статус "entered")
  - Обрабатывает долгое нажатие (показывает меню)

#### StatusMenu
Модальное меню для выбора статуса

- **Props**:
  - `participant: Person` - данные участника
  - `isOpen: boolean` - открыто ли меню
  - `onClose: () => void` - закрытие меню
  - `onSelect: (status: ParticipantStatusType) => void` - выбор статуса

- **Функционал**:
  - Отображает информацию о участнике (ФИО, группа, оплата)
  - Опции: "Опоздал", "Не пришел", "Сбросить"
  - Закрывается после выбора или при клике вне меню

#### Timer
Компонент кнопки старта таймера и логика отслеживания времени

- **Props**:
  - `isRunning: boolean` - запущен ли таймер
  - `raceData: Race` - данные соревнования для вычисления интервалов
  - `onStart: () => void` - запуск таймера
  - `currentRow: number` - текущая строка (для передачи в StartGridTable)
  - `onRowChange: (row: number) => void` - обновление текущей строки

- **Функционал**:
  - Кнопка "Старт" в верхней части шахматки
  - Скрывается после запуска таймера
  - Появляется снова при остановке таймера через меню "Завершить"
  - При запуске вычисляет массив интервалов между строками
  - Каждую секунду определяет текущую строку на основе прошедшего времени и интервалов
  - Передает текущую строку в StartGridTable для выделения

#### ContextMenu
Контекстное меню управления таймером

- **Props**:
  - `isOpen: boolean` - открыто ли меню
  - `onClose: () => void` - закрытие меню
  - `onFinish: () => void` - остановка таймера
  - `onShowReport: () => void` - показ отчета
  - `onChangeLanguage: (lang: 'ru' | 'en' | 'kk') => void` - смена языка
  - `currentLanguage: 'ru' | 'en' | 'kk'` - текущий язык
  - `autoScrollEnabled: boolean` - включен ли автоскроллинг
  - `onToggleAutoScroll: (enabled: boolean) => void` - переключение автоскроллинга
  - `onResetTimer: (rowNumber: number) => void` - сброс таймера на строку
  - `onDeleteProject: () => void` - удаление текущего проекта
  - `onBackToProjects: () => void` - возврат к списку проектов

- **Функционал**:
  - Иконка (три точки/полоски) в нижней правой части экрана
  - Отображается всегда (и когда таймер запущен, и когда остановлен)
  - Опции: "Завершить", "Отчет", "Язык" (подменю с выбором языка), "Авто скроллинг текущей строки" (переключатель), "Сбросить таймер на N строку", "Удалить текущий проект", "Вернуться к списку проектов"
  - При выборе "Язык" открывается подменю с флагами/названиями языков: Русский, English, Қазақша
  - Текущий выбранный язык отмечен галочкой или выделен
  - При выборе языка меняется язык интерфейса и сохраняется в LocalStorage
  - Опция "Авто скроллинг текущей строки" отображается как переключатель (toggle/checkbox) с визуальной индикацией состояния
  - При выборе "Сбросить таймер на N строку" открывает ResetTimerDialog
  - При выборе "Удалить текущий проект" открывает DeleteProjectDialog
  - При выборе "Вернуться к списку проектов" возвращает к ProjectList

#### ResetTimerDialog
Диалог подтверждения сброса таймера

- **Props**:
  - `isOpen: boolean` - открыт ли диалог
  - `onClose: () => void` - закрытие диалога
  - `onConfirm: (rowNumber: number) => void` - подтверждение сброса
  - `maxRows: number` - максимальное количество строк (для валидации)

- **Функционал**:
  - Поле ввода номера строки
  - Предупреждающий текст о сбросе статусов
  - Кнопки "Отмена" и "Сбросить"
  - Валидация ввода (только числа, в пределах допустимого диапазона)

#### DeleteProjectDialog
Диалог подтверждения удаления проекта

- **Props**:
  - `isOpen: boolean` - открыт ли диалог
  - `onClose: () => void` - закрытие диалога
  - `onConfirm: () => void` - подтверждение удаления
  - `projectName: string` - название проекта (для отображения в предупреждении)

- **Функционал**:
  - Предупреждающий текст: "Вы уверены, что хотите удалить проект '{projectName}'? Это действие нельзя отменить."
  - Кнопки "Отмена" и "Удалить"
  - Кнопка "Удалить" выделена красным цветом для указания на опасное действие

#### ReportView
Страница отчета

- **Props**:
  - `raceData: Race` - данные соревнования
  - `statuses: Record<string, ParticipantStatus>` - статусы участников

- **Функционал**:
  - Подсчет статистики
  - Отображение списков участников по категориям
  - Экспорт и печать

### Формат данных в LocalStorage

```typescript
interface Project {
  id: string;  // UUID или timestamp
  name: string;  // Название проекта (race.title + date)
  createdAt: number;  // timestamp создания
  updatedAt: number;  // timestamp последнего обновления
  raceData: Race;  // Данные из SportOrg
  statuses: Record<string, ParticipantStatus>;
  timerState: {
    started: boolean;
    startTime: number | null;  // timestamp
    currentRow: number | null;
  };
  settings: {
    autoScrollEnabled: boolean;  // Включен ли автоматический скроллинг
  };
}

interface StoredData {
  projects: Project[];  // Массив всех проектов
  settings: {
    language: 'ru' | 'en' | 'kk';
    currentProjectId: string | null;  // ID текущего открытого проекта
  };
}

interface ParticipantStatus {
  status: ParticipantStatusType;
  timestamp: number;  // Когда был установлен статус
  delayMinutes?: number;  // Только для статуса "late"
}

type ParticipantStatusType = 'not_set' | 'entered' | 'late' | 'absent';
```

### Статусы участников

```typescript
enum ParticipantStatusType {
  NOT_SET = 'not_set',    // Не отмечен (по умолчанию) - без цвета
  ENTERED = 'entered',    // Зашел - зеленый цвет
  LATE = 'late',          // Опоздал - оранжевый цвет
  ABSENT = 'absent'       // Не пришел - красный цвет
}
```

### Взаимодействие с участником

1. **Быстрое нажатие (click/tap)**:
   - Устанавливает статус `entered` (зеленый)
   - Сохраняет в LocalStorage

2. **Долгое нажатие (long press, 500ms+)**:
   - Показывает модальное меню StatusMenu
   - В меню отображается:
     - ФИО участника
     - Группа
     - Статус оплаты (оплачен/не оплачен)
     - Кнопки: "Опоздал", "Не пришел", "Сбросить"
   - Выбор опции устанавливает соответствующий статус
   - Опция "Сбросить" устанавливает статус `not_set` и удаляет запись из статусов

### Работа таймера

- При нажатии "Старт":
  - Сохраняется текущее время как `timerStartTime`
  - Вычисляется массив интервалов между строками на основе времени старта участников
  - Текущая строка устанавливается в 0
  - Кнопка "Старт" скрывается
  - Появляется иконка контекстного меню в нижней правой части
  
- Вычисление интервалов между строками:
  - Для каждой строки вычисляется интервал до следующей строки
  - Интервал[i] = startTime[i+1] - startTime[i] (в миллисекундах)
  - Массив интервалов создается один раз при запуске таймера или изменении данных
  
- Определение текущей строки:
  - Прошедшее время = Date.now() - timerStartTime
  - Сумма интервалов = 0
  - Для каждой строки i:
    - Если прошедшее время >= сумма интервалов + интервал[i]:
      - Сумма интервалов += интервал[i]
      - Текущая строка = i + 1
    - Иначе: остановка, текущая строка = i
  - Строка с текущим индексом выделяется (например, цветом фона)
  - При переходе на следующую строку выделение плавно перемещается
  
- Автоматический скроллинг:
  - Если `autoScrollEnabled === true` и пользователь не прокручивал таблицу последние 3 секунды:
    - При изменении `currentRow` автоматически прокручивается таблица
    - Текущая строка позиционируется сверху экрана
    - Используется плавная прокрутка (`scrollIntoView({ behavior: 'smooth', block: 'start' })`)
  - Если пользователь прокручивает таблицу вручную - автоскроллинг временно отключается на 3 секунды
  - Состояние `autoScrollEnabled` сохраняется в настройках проекта и восстанавливается при загрузке

- Опция "Завершить":
  - Останавливает таймер (сбрасывает `isRunning`)
  - Кнопка "Старт" появляется снова
  - Иконка контекстного меню скрывается

- Опция "Вернуться к списку проектов":
  - Возвращает к ProjectList без удаления проекта
  - Сохраняет состояние таймера и статусов участников
  
- Опция "Удалить текущий проект":
  - Открывает диалог подтверждения DeleteProjectDialog
  - При подтверждении:
    - Удаляет проект из массива `projects` в LocalStorage
    - Обновляет `currentProjectId` в настройках на `null`
    - Возвращает к ProjectList
    - ProjectList автоматически отображает:
      - Если остались другие проекты: список проектов + кнопка "Создать проект"
      - Если проект был последним (список пуст): только кнопку "Создать проект" (как при первом открытии приложения)

- Опция "Сбросить таймер на N строку":
  - Открывается диалог с полем ввода номера строки
  - Пользователь вводит номер строки (индекс строки в таблице, начиная с 0 или 1)
  - После подтверждения:
    - Определяется время старта для указанной строки из данных соревнования
    - Вычисляется сумма интервалов от строки 0 до указанной строки N
    - Пересчитывается `timerStartTime` = текущее время - сумма интервалов до строки N
    - Текущая строка устанавливается в N
    - Находятся все участники, чье время старта >= времени указанной строки
    - Сбрасываются их статусы в `not_set` (удаляются из `statuses`)
    - Сохраняется в LocalStorage

### Парсинг HTML файла SportOrg

1. Загрузить HTML файл через FileReader
2. Извлечь JavaScript код из тега `<script>`
3. Выполнить код в безопасном контексте (или парсить регулярными выражениями)
4. Извлечь объект `race` из глобальной области видимости
5. Валидировать структуру данных
6. Преобразовать данные в типизированный объект Race

### Экспорт данных

**JSON формат**:
```json
{
  "race": { /* данные соревнования */ },
  "statuses": { /* статусы участников */ },
  "report": {
    "totalEntered": 150,
    "totalLate": 5,
    "totalAbsent": 10,
    "lateParticipants": [...],
    "absentParticipants": [...]
  },
  "exportTime": "2025-10-31T10:30:00Z"
}
```

**CSV формат**:
```csv
Bib,Name,Surname,Group,Status,DelayMinutes
212,Алина,Сергеева,W21А,entered,
303,Екатерина,Санникова,W21А,late,5
```

